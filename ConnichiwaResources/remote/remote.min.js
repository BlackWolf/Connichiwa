"use strict";function CRURLParser(url){var parser=document.createElement("a");return parser.href=url,parser}var CRDebug=function(){var debug=!1,enableDebug=function(){debug=!0},log=function(priority,message){debug&&console.log(priority+"|"+message)};return{enableDebug:enableDebug,log:log}}(),CRMasterCommunicationParser=function(){var parse=function(message){CRDebug.log(4,"Received message: "+message);var object=JSON.parse(message);"softdisconnect"===object.type&&Remote._softDisconnectWebsocket(),"show"===object.type&&window.requestAnimationFrame(function(){$("body").append(object.content)}),"update"===object.type&&window.requestAnimationFrame(function(){$(object.element).html(object.content)}),"updateStyle"===object.type&&window.requestAnimationFrame(function(){for(var style in object.styles)$(object.element).css(style,object.styles[style])}),"beginPath"===object.type&&window.requestAnimationFrame(function(){var context=$(object.element)[0].getContext("2d");context.beginPath(),context.moveTo(object.coords.x,object.coords.y)}),"updatePath"===object.type&&window.requestAnimationFrame(function(){var context=$(object.element)[0].getContext("2d");context.lineTo(object.coords.x,object.coords.y),context.stroke()}),"endPath"===object.type&&window.requestAnimationFrame(function(){var context=$(object.element)[0].getContext("2d");context.closePath()}),"loadScript"===object.type&&$.getScript(object.url,function(){var message={type:"scriptLoaded",request:object};Remote.send(message)})};return{parse:parse}}(),CRNativeCommunicationParser=function(){var parse=function(message){CRDebug.log(4,"Parsing native message: "+message);var object=JSON.parse(message);switch(object.type){case"connectwebsocket":_parseConnectWebsocket(object);break;case"cwdebug":_parseDebug(object);break;case"remoteidentifier":_parseRemoteIdentifier(object);break;case"disconnectwebsocket":_parseDisconnectWebsocket(object)}},_parseConnectWebsocket=function(){Remote._connectWebsocket()},_parseDebug=function(){CRDebug.enableDebug()},_parseRemoteIdentifier=function(message){var data={type:"remoteidentifier",identifier:message.identifier};Remote.send(data)},_parseDisconnectWebsocket=function(){Remote._disconnectWebsocket()};return{parse:parse}}(),Remote=function(){function _cleanupWebsocket(){void 0!==_websocket&&(_websocket.onopen=void 0,_websocket.onmessage=void 0,_websocket.onclose=void 0,_websocket.onerror=void 0,_websocket=void 0)}var _websocket,_parsedURL=new CRURLParser(document.URL),softDisconnected=!1,_connectWebsocket=function(){var oldWebsocket=_websocket;_cleanupWebsocket(),void 0!==oldWebsocket&&oldWebsocket.close(),_websocket=new WebSocket("ws://"+_parsedURL.hostname+":"+(parseInt(_parsedURL.port)+1)),_websocket.onopen=onWebsocketOpen,_websocket.onmessage=onWebsocketMessage,_websocket.onclose=onWebsocketClose,_websocket.onerror=onWebsocketError},_softDisconnectWebsocket=function(){softDisconnected=!0,nativeCallSoftDisconnect()},onWebsocketOpen=function(){CRDebug.log(3,"Websocket opened"),softDisconnected=!1,nativeCallWebsocketDidOpen()},onWebsocketMessage=function(e){var message=e.data;CRMasterCommunicationParser.parse(message)},onWebsocketClose=function(){CRDebug.log(3,"Websocket closed"),_cleanupWebsocket(),nativeCallWebsocketDidClose()},onWebsocketError=function(){onWebsocketClose()},_send=function(message){CRDebug.log(4,"Sending message: "+message),_websocket.send(message)},send=function(messageObject){_send(JSON.stringify(messageObject))};return{_connectWebsocket:_connectWebsocket,_softDisconnectWebsocket:_softDisconnectWebsocket,send:send}}();