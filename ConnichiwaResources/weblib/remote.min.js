"use strict";function CWDevice(t){if(!t.identifier)throw"Cannot instantiate CWDevice without an identifier";this.discoveryState=CWDeviceDiscoveryState.LOST,this.connectionState=CWDeviceConnectionState.DISCONNECTED,this.distance=-1;var e=t.identifier,i=Date.now()/1e3,n=[],o=void 0,a="remote device",s=CWSystemInfo.DEFAULT_PPI();return t.launchDate&&(i=t.launchDate),t.ips&&(n=t.ips),t.port&&(o=t.port),t.name&&(a=t.name),t.ppi&&t.ppi>0&&(s=t.ppi),this.getIdentifier=function(){return e},this.getLaunchDate=function(){return i},this.getIPs=function(){return n},this.getPort=function(){return o},this.getName=function(){return a},this.getPPI=function(){return s},this.isLocal=function(){return this.equalTo(Connichiwa.getLocalDevice())},this.isNearby=function(){return this.discoveryState===CWDeviceDiscoveryState.DISCOVERED},this.canBeConnected=function(){return this.connectionState===CWDeviceConnectionState.DISCONNECTED&&this.discoveryState===CWDeviceDiscoveryState.DISCOVERED},this.isConnected=function(){return this.connectionState===CWDeviceConnectionState.CONNECTED},this}function CWLocation(t,e,i,n,o){if(o===!0){var a=CWLocation.toGlobal(t,e,i,n);this.x=a.x,this.y=a.y,this.width=a.width,this.height=a.height}else this.x=t,this.y=e,this.width=i,this.height=n;CWEventManager.register("wasUnstitched",function(t){this.x-=t.deviceTransformation.x,this.y-=t.deviceTransformation.y,this.x*=t.deviceTransformation.scale,this.y*=t.deviceTransformation.scale,this.width*=t.deviceTransformation.scale,this.height*=t.deviceTransformation.scale}.bind(this)),CWEventManager.register("wasStitched",function(t){this.x/=t.deviceTransformation.scale,this.y/=t.deviceTransformation.scale,this.width/=t.deviceTransformation.scale,this.height/=t.deviceTransformation.scale,this.x+=t.deviceTransformation.x,this.y+=t.deviceTransformation.y}.bind(this)),this.getGlobal=function(){return{x:this.x,y:this.y,width:this.width,height:this.height}},this.getLocal=function(){return CWLocation.toLocal(this.x,this.y,this.width,this.height)},this.getGlobalX=function(){return this.x},this.getGlobalY=function(){return this.y},this.getGlobalWidth=function(){return this.width},this.getGlobalHeight=function(){return this.height},this.getLocalX=function(){return this.getLocal().x},this.getLocalY=function(){return this.getLocal().y},this.getLocalWidth=function(){return this.getLocal().width},this.getLocalHeight=function(){return this.getLocal().height},this.setGlobal=function(t,e,i,n){void 0!==t&&(this.x=t),void 0!==e&&(this.y=e),void 0!==i&&(this.width=i),void 0!==n&&(this.height=n)},this.setLocal=function(t,e,i,n){CWDebug.log(3,"To Global: "+t+", "+e+", "+i+", "+n);var o=CWLocation.toGlobal(t,e,i,n);CWDebug.log(3,JSON.stringify(o)),this.x=o.x,this.y=o.y,this.width=o.width,this.height=o.height},this.setGlobalX=function(t){this.setGlobal(t,this.y,this.width,this.height)},this.setGlobalY=function(t){this.setGlobal(this.x,t,this.width,this.height)},this.setGlobalWidth=function(t){this.setGlobal(this.x,this.y,t,this.height)},this.setGlobalHeight=function(t){this.setGlobal(this.x,this.y,this.width,t)},this.setLocalX=function(t){var e=this.getLocal();this.setLocal(t,e.y,e.width,e.height)},this.setLocalY=function(t){var e=this.getLocal();this.setLocal(e.x,t,e.width,e.height)},this.setLocalWidth=function(t){var e=this.getLocal();this.setLocal(e.x,e.y,t,e.height)},this.setLocalHeight=function(t){var e=this.getLocal();this.setLocal(e.x,e.y,e.width,t)},this.toString=function(){return JSON.stringify(this.getGlobal())},this.copy=function(){return CWLocation.fromString(this.toString())}}function CWPoint(t,e,i){return new CWLocation(t,e,void 0,void 0,i)}function CWSize(t,e,i){return new CWLocation(void 0,void 0,t,e,i)}function CWVector(t,e){if(void 0===t||void 0===e)throw"Cannot instantiate Vector without 2 points";var i=t,n=e,o=n.x-i.x,a=n.y-i.y,s=Math.sqrt(Math.pow(o,2)+Math.pow(a,2));this.p1=function(){return i},this.p2=function(){return n},this.deltaX=function(){return o},this.deltaY=function(){return a},this.length=function(){return s}}var OOP=function(){var t="default",e={},i={},n=function(e,i,n){return void 0===n&&(n=i,i=e,e=t),o(e,i,n)},o=function(t,n,o){var a={private:function(){},package:function(){},public:function(){}};t in i==!1&&(i[t]=function(){});var c=i[t];return c[n]=a.package,a.private.package=c,t in e==!1&&(e[t]={}),e[t][n]=a,s(t,n,o)},a=function(e,i,n){return void 0===n&&(n=i,i=e,e=t),s(e,i,n)},s=function(t,i,n){if(t in e!=!1&&i in e[t]!=!1){var o=!1,a=e[t][i],s=function(t,e){return function(){return t[e]}},c=function(t,e){return function(i){t[e]=i}},r=function(){return void 0},h=function(){throw new TypeError("Cannot set non-visible property")};for(var u in n)if(n.hasOwnProperty(u)){var l="private",d=u;if(0===d.indexOf("public ")?(l="public",d=d.substr(7)):0===d.indexOf("package ")?(l="package",d=d.substr(8)):0===d.indexOf("private ")&&(d=d.substr(8)),"function"==typeof n[u]){var g=n[u].bind(a.private);switch(l){case"private":a.private[d]=g;break;case"package":a.private[d]=g,a.package[d]=g;break;case"public":a.private[d]=g,a.package[d]=g,a.public[d]=g}"__constructor"===d&&(o=!0)}else switch(l){case"private":a.private[d]=n[u],Object.defineProperty(a.package,d,{get:r,set:h}),Object.defineProperty(a.public,d,{get:r,set:h});break;case"package":a.package[d]=n[u],Object.defineProperty(a.private,d,{get:s(a.package,d),set:c(a.package,d)}),Object.defineProperty(a.public,d,{get:r,set:h});break;case"public":a.public[d]=n[u],Object.defineProperty(a.private,d,{get:s(a.public,d),set:c(a.public,d)}),Object.defineProperty(a.package,d,{get:s(a.public,d),set:c(a.public,d)})}}return o===!0&&window.setTimeout(a.private.__constructor,0),a.public}};return{createSingleton:n,extendSingleton:a}}(),CWDebug=function(){var t=!0,e=function(){t=!0},i=function(){t=!1},n=function(e,i){t&&console.log(e+"|"+i)};return{enableDebug:e,disableDebug:i,log:n}}(),CWDeviceDiscoveryState={DISCOVERED:"discovered",LOST:"lost"},CWDeviceConnectionState={DISCONNECTED:"disconnected",CONNECTING:"connecting",CONNECTED:"connected"};CWDevice.prototype.insert=function(t,e){Connichiwa.insert(this.getIdentifier(),t,e)},CWDevice.prototype.replace=function(t,e){Connichiwa.replace(this.getIdentifier(),t,e)},CWDevice.prototype.replaceContent=function(t,e){Connichiwa.replaceContent(this.getIdentifier(),t,e)},CWDevice.prototype.loadScript=function(t,e){Connichiwa.loadScript(this.getIdentifier(),t,e)},CWDevice.prototype.loadCSS=function(t){Connichiwa.loadCSS(this.getIdentifier(),t)},CWDevice.prototype.send=function(t,e){Connichiwa.send(this.getIdentifier(),t,e)},CWDevice.prototype.equalTo=function(t){return CWDevice.prototype.isPrototypeOf(t)===!1?!1:this.getIdentifier()===t.getIdentifier()},CWDevice.prototype.toString=function(){return this.getIdentifier()};var CWEventManager=function(){var t={},e=function(e,i){if("string"!=typeof e)throw"Event name must be a string";if("function"!=typeof i)throw"Event callback must be a function";if(e=e.toLowerCase(),-1===e.indexOf(" "))t[e]||(t[e]=[]),t[e].push(i),CWDebug.log(3,"Attached callback to "+e);else for(var n=e.split(" "),o=0;o<n.length;o++)CWEventManager.register(n[o],i)},i=function(e,i){var n=Array.prototype.slice.call(arguments);if(CWUtil.isString(e)===!0?(i=e,e=4,n.shift()):(n.shift(),n.shift()),i=i.toLowerCase(),!t[i])return void CWDebug.log(5,"No callbacks  for "+i+" registered");CWDebug.log(e,"Triggering event "+i+" for "+t[i].length+" callbacks");for(var o=0;o<t[i].length;o++){var a=t[i][o];a.apply(null,n)}};return{register:e,trigger:i}}(),CWGestures=OOP.createSingleton("Connichiwa","CWGestures",{"private _touchStart":void 0,"private _touchLast":void 0,"private _touchLastVector":void 0,"private _touchCheckable":!1,"private _touchAngleReferenceVector":void 0,"private _touchAngleChangedCount":0,__constructor:function(){var t=this;$(document).ready(function(){t.captureOn($("body"))})},"private _onDown":function(t){this._touchStart=CWUtil.getEventLocation(t,"client")},"private _onMove":function(t){if(void 0!==this._touchStart){var e=CWUtil.getEventLocation(t,"client");if(void 0!==this._touchLast){var i=new CWVector(this._touchStart,e),n=new CWVector(this._touchLast,e);if(this._touchCheckable=this._touchCheckable||i.length()>5,this._touchCheckable&&n.length()>1)if(void 0!==this._touchAngleReferenceVector){var o=n.angle(this._touchAngleReferenceVector);if(o>20){if(this._touchAngleChangedCount++,3===this._touchAngleChangedCount)return this._touchStart=void 0,void(this._touchLast=void 0)}else this._touchAngleReferenceVector=void 0,this._touchAngleChangedCount=0}else if(void 0!==this._touchLastVector){var a=n.angle(this._touchLastVector);a>20&&(this._touchAngleReferenceVector=this._touchLastVector,this._touchAngleChangedCount=1)}n.length()>0&&(this._touchLastVector=n)}this._touchLast=e}},"private _onUp":function(){var t=this._touchStart,e=this._touchLast;if(this._touchStart=void 0,this._touchLast=void 0,this._touchLastVector=void 0,this._touchCheckable=!1,this._touchAngleReferenceVector=void 0,this._touchAngleChangedCount=0,void 0!==t&&void 0!==e){var i=e.x-t.x,n=e.y-t.y,o=Math.sqrt(Math.pow(i,2)+Math.pow(n,2));if(10>=o)return void CWDebug.log(3,"Swipe REJECTED because it was too short ("+o+")");var a=.25;100>o&&(a=.35),50>o&&(a=.4),40>o&&(a=.45),15>o&&(a=.8);var s="invalid";Math.abs(n)<Math.abs(i)*a&&(i>0&&(s="right"),0>i&&(s="left")),Math.abs(i)<Math.abs(n)*a&&(n>0&&(s="down"),0>n&&(s="up"));var c=$(window).height()-window.innerHeight;e.y+=c;var r=e.y<=50,h=e.x<=50,u=e.y>=$(window).height()-50,l=e.x>=$(window).width()-50,d="invalid";if(r&&"up"===s&&(d="top"),h&&"left"===s&&(d="left"),u&&"down"===s&&(d="bottom"),l&&"right"===s&&(d="right"),"invalid"===d)return void CWDebug.log(3,"Swipe REJECTED. Ending: x - "+e.x+"/"+($(window).width()-50)+", y - "+e.y+"/"+($(window).height()-50)+". Direction: "+s+". Edge endings: "+r+", "+l+", "+u+", "+h);"top"===d&&(e.y=0),"left"===d&&(e.x=0),"bottom"===d&&(e.y=$(window).height()),"right"===d&&(e.x=$(window).width());var g={edge:d,x:e.x,y:e.y};CWEventManager.trigger("stitchswipe",g)}},"public captureOn":function(t){t instanceof jQuery&&(t=t.get(0)),t.addEventListener("mousedown",this._onDown,!0),t.addEventListener("touchstart",this._onDown,!0),t.addEventListener("mousemove",this._onMove,!0),t.addEventListener("touchmove",this._onMove,!0),t.addEventListener("mouseup",this._onUp,!0),t.addEventListener("touchend",this._onUp,!0)}}),CWGyroscope=OOP.createSingleton("Connichiwa","CWGyroscope",{_lastMeasure:void 0,_alphaGammaFlipped:!1,__constructor:function(){gyro.frequency=500,gyro.startTracking(this._onUpdate)},"private _onUpdate":function(t){if(null!==t.alpha&&null!==t.beta&&null!==t.gamma&&null!==t.x&&null!==t.y&&null!==t.z){if(void 0===this._lastMeasure&&(this._lastMeasure=t),t.alpha<0||t.gamma>180){this._alphaGammaFlipped=!0;var e=this._lastMeasure.alpha;this._lastMeasure.alpha=this._lastMeasure.gamma,this._lastMeasure.gamma-e}var i=this._alphaGammaFlipped?t.gamma:t.alpha,n=t.beta,o=this._alphaGammaFlipped?t.alpha:t.gamma,a=i-this._lastMeasure.alpha,s=n-this._lastMeasure.beta,c=o-this._lastMeasure.gamma,r={alpha:i,beta:n,gamma:o,delta:{alpha:a,beta:s,gamma:c}};CWEventManager.trigger(5,"gyroscopeUpdate",r);var h=t.x-this._lastMeasure.x,u=t.y-this._lastMeasure.y,l=t.z-this._lastMeasure.z,d={x:t.x,y:t.y,z:t.z,delta:{x:h,y:u,z:l}};CWEventManager.trigger(5,"accelerometerUpdate",d),this._lastMeasure={x:t.x,y:t.y,z:t.z,alpha:i,beta:n,gamma:o}}},"package getLastGyroscopeMeasure":function(){return void 0===this._lastMeasure?void 0:{alpha:this._lastMeasure.alpha,beta:this._lastMeasure.beta,gamma:this._lastMeasure.gamma}},"package getLastAccelerometerMeasure":function(){return void 0===this._lastMeasure?void 0:{x:this._lastMeasure.x,y:this._lastMeasure.y,z:this._lastMeasure.z}}});CWLocation.toGlobal=function(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0);var o={x:t,y:e,width:i,height:n},a=CWStitchManager.getDeviceTransformation();return 0===a.rotation&&(o.y=e,o.x=t,o.width=i,o.height=n),90===a.rotation&&(o.y=a.height*a.scale-t-i,o.x=e,o.width=n,o.height=i),180===a.rotation&&(o.y=a.height*a.scale-e-n,o.x=a.width*a.scale-t-i,o.width=i,o.height=n),270===a.rotation&&(o.y=t,o.x=a.width*a.scale-e-n,o.width=n,o.height=i),o.x+=a.x*a.scale,o.y+=a.y*a.scale,o.x/=a.scale,o.y/=a.scale,o.width/=a.scale,o.height/=a.scale,o},CWLocation.toLocal=function(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0);var o={x:t,y:e,width:i,height:n},a=CWStitchManager.getDeviceTransformation();return 0===a.rotation&&(o.y=e-a.y,o.x=t-a.x,o.width=i,o.height=n),90===a.rotation&&(o.y=t-a.x,o.x=a.height-(e-a.y+n),o.width=n,o.height=i),180===a.rotation&&(o.y=a.height-(e-a.y+n),o.x=a.width-(t-a.x+i),o.width=i,o.height=n),270===a.rotation&&(o.y=a.width-(t-a.x+i),o.x=e-a.y,o.width=n,o.height=i),o.x*=a.scale,o.y*=a.scale,o.width*=a.scale,o.height*=a.scale,o},CWLocation.applyRotation=function(t,e,i,n,o){var a=CWStitchManager.getDeviceTransformation();void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===o&&(o=a.rotation);var s={x:t,y:e,width:i,height:n};return 0===a.rotation&&(s.y=e,s.x=t,s.width=i,s.height=n),90===a.rotation&&(s.y=-t,s.x=e,s.width=n,s.height=i),180===a.rotation&&(s.y=-e,s.x=-t,s.width=i,s.height=n),270===a.rotation&&(s.y=t,s.x=-e,s.width=n,s.height=i),s},CWLocation.fromString=function(t){var e=JSON.parse(t);return new CWLocation(parseFloat(e.x),parseFloat(e.y),parseFloat(e.width),parseFloat(e.height),!1)};var CWStitchManager=OOP.createSingleton("Connichiwa","CWStitchManager",{"private _isStitched":!1,"private _deviceTransformation":void 0,"private _gyroDataOnStitch":void 0,"public unstitchOnMove":!0,"public ignoreMoveAxis":[],__constructor:function(){Connichiwa.on("stitchswipe",this._onLocalSwipe),Connichiwa.on("wasStitched",this._onWasStitched),Connichiwa.on("wasUnstitched",this._onWasUnstitched),Connichiwa.on("gyroscopeUpdate",this._onGyroUpdate),Connichiwa.on("accelerometerUpdate",this._onAccelerometerUpdate)},_onWasStitched:function(t){this._gyroDataOnStitch=this.package.CWGyroscope.getLastGyroscopeMeasure(),this._deviceTransformation=t.deviceTransformation,this._isStitched=!0},_onWasUnstitched:function(){this._gyroDataOnStitch=void 0,this._deviceTransformation=this.DEFAULT_DEVICE_TRANSFORMATION(),this._isStitched=!1},_onLocalSwipe:function(t){t.device=Connichiwa.getIdentifier(),t.width=CWSystemInfo.viewportWidth(),t.height=CWSystemInfo.viewportHeight(),Connichiwa.send("master","_stitchswipe",t)},_onGyroUpdate:function(t){if(this.isStitched()!==!1&&this.unstitchOnMove!==!1){void 0===this._gyroDataOnStitch&&(this._gyroDataOnStitch=t);var e=Math.abs(t.alpha-this._gyroDataOnStitch.alpha),i=Math.abs(t.beta-this._gyroDataOnStitch.beta),n=Math.abs(t.gamma-this._gyroDataOnStitch.gamma);e=Math.abs((e+180)%360-180),i=Math.abs((i+180)%360-180),n=Math.abs((n+180)%360-180),(CWUtil.inArray("alpha",this.ignoreMoveAxis)===!1&&e>=35||CWUtil.inArray("beta",this.ignoreMoveAxis)===!1&&i>=20||CWUtil.inArray("gamma",this.ignoreMoveAxis)===!1&&n>=20)&&this._quitStitch()}},_onAccelerometerUpdate:function(t){if(this.isStitched()!==!1&&this.unstitchOnMove!==!1){var e=Math.abs(t.x),i=Math.abs(t.y),n=Math.abs(Math.abs(t.z)-9.81);(CWUtil.inArray("x",this.ignoreMoveAxis)===!1&&e>=1||CWUtil.inArray("y",this.ignoreMoveAxis)===!1&&i>=1||CWUtil.inArray("z",this.ignoreMoveAxis)===!1&&n>=1)&&this._quitStitch()}},"private _quitStitch":function(){var t={device:Connichiwa.getIdentifier()};Connichiwa.send("master","_quitstitch",t)},"public unstitch":function(){this._quitStitch()},"public isStitched":function(){return this._isStitched},"public getDeviceTransformation":function(){return void 0===this._deviceTransformation?this.DEFAULT_DEVICE_TRANSFORMATION():this._deviceTransformation},"private DEFAULT_DEVICE_TRANSFORMATION":function(){return{x:0,y:0,width:CWSystemInfo.viewportWidth(),height:CWSystemInfo.viewportHeight(),rotation:0,scale:1}}}),CWSystemInfo=OOP.createSingleton("Connichiwa","CWSystemInfo",{_ppi:void 0,"public PPI":function(){return void 0!==this._ppi?this._ppi:(this._ppi=this.DEFAULT_PPI(),window.devicePixelRatio>1&&(this._ppi=142),"iPad"===navigator.platform&&(this._ppi=132),("iPhone"===navigator.platform||"iPod"===navigator.platform)&&(this._ppi=3===window.devicePixelRatio?153:163),this._ppi)},"public isLandscape":function(){return window.innerHeight<window.innerWidth},"public viewportWidth":function(){return $(window).width()},"public viewportHeight":function(){return $(window).height()},"public DEFAULT_PPI":function(){return 100}}),CWUtil=function(){var t=function(t){var e=document.createElement("a");return e.href=t,e},e=function(t,e){void 0===e&&(e="page");var i={x:t[e+"X"],y:t[e+"Y"]};if(void 0===i.x||void 0===i.y){var n=void 0===t.originalEvent?t.targetTouches:t.originalEvent.targetTouches;i={x:n[0][e+"X"],y:n[0][e+"Y"]}}return i},i=function(t,e){return void 0===e&&void 0!==t?(e=t,t=0):void 0===e&&void 0===t&&(t=0,e=Number.MAX_VALUE),Math.floor(Math.random()*(e-t+1))+t},n=function(t){return t===parseInt(t)},o=function(t){return"string"==typeof t},a=function(t){return"object"==typeof t&&null!==t},s=function(t,e){return e.indexOf(t)>-1},c=function(t){return t?(t^16*Math.random()>>t/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,CWUtil.createUUID)};return{parseURL:t,getEventLocation:e,randomInt:i,isInt:n,isString:o,isObject:a,inArray:s,createUUID:c}}();CWVector.prototype.angle=function(t){var e=this.deltaX()*t.deltaX()+this.deltaY()*t.deltaY(),i=this.length()*t.length();return Math.acos(e/i)*(180/Math.PI)};var CWWebsocketMessageParser=OOP.createSingleton("Connichiwa","CWWebsocketMessageParser",{"package parse":function(t){switch(t._name){case"_ack":this._parseAck(t);break;case"_insert":this._parseInsert(t);break;case"_replace":this._parseReplace(t);break;case"_loadscript":this._parseLoadScript(t);break;case"_loadcss":this._parseLoadCSS(t);break;case"_wasstitched":this._parseWasStitched(t);break;case"_wasunstitched":this._parseWasUnstitched(t);break;case"_gotstitchneighbor":this._parseGotStitchNeighbor(t)}return!0},_parseAck:function(t){CWEventManager.trigger("__ack_message"+t.original._id)},_parseInsert:function(t){$(t.selector).append(t.html)},_parseReplace:function(t){t.contentOnly===!0?$(t.selector).html(t.html):$(t.selector).replaceWith(t.html)},_parseLoadScript:function(t){var e=this;$.getScript(t.url).done(function(){e.package.Connichiwa._sendAck(t)}).fail(function(e,i,n){CWDebug.log(1,"There was an error loading '"+t.url+"': "+n)})},_parseLoadCSS:function(t){var e=document.createElement("link");e.setAttribute("rel","stylesheet"),e.setAttribute("type","text/css"),e.setAttribute("href",t.url),$("head").append(e),this.package.Connichiwa._sendAck(t)},_parseWasStitched:function(t){CWEventManager.trigger("wasStitched",t)},_parseWasUnstitched:function(t){CWEventManager.trigger("wasUnstitched",t)},_parseGotStitchNeighbor:function(t){CWEventManager.trigger("gotstitchneighbor",t)}}),Connichiwa=OOP.createSingleton("Connichiwa","Connichiwa",{"private _websocket":void 0,"public getLocalDevice":function(){},"public getIdentifier":function(){},"public isMaster":function(){},"public on":function(t,e){return"load"===t?void this.onLoad(e):void CWEventManager.register(t,e)},"public onMessage":function(t,e){this.on("message"+t,e)},"public onLoad":function(t){"complete"===document.readyState?t():Connichiwa.on("ready",t)},"public insert":function(t,e,i){if(void 0===i&&(i=e,e="body"),CWUtil.isObject(e)&&(e="#"+$(e).attr("id")),CWUtil.isObject(i)===!0){var n=$(i),o=n.clone();o[0].style.cssText=n[0].style.cssText,i=o[0].outerHTML}CWDevice.prototype.isPrototypeOf(t)&&(t=t.getIdentifier());var a={selector:e,html:i};this.send(t,"_insert",a)},"public replace":function(t,e,i){void 0===i&&(i=e,e="body"),this._replace(t,e,i,!1)},"public replaceContent":function(t,e,i){void 0===i&&(i=e,e="body"),this._replace(t,e,i,!0)},"private _replace":function(t,e,i,n){if(void 0===i&&(i=e,e="body"),CWUtil.isObject(e)&&(e="#"+$(e).attr("id")),CWUtil.isObject(i)===!0){var o=$(i),a=o.clone();a[0].style.cssText=o[0].style.cssText,i=a[0].outerHTML}CWDevice.prototype.isPrototypeOf(t)&&(t=t.getIdentifier());var s={selector:e,html:i,contentOnly:n};this.send(t,"_replace",s)},"public loadScript":function(t,e,i){var n={url:e},o=this.send(t,"_loadscript",n);void 0!==i&&this.on("__ack_message"+o,i)},"public loadCSS":function(t,e){{var i={url:e};this.send(t,"_loadcss",i)}},"public send":function(t,e,i){return void 0===i&&(i=t,t="master"),CWDevice.prototype.isPrototypeOf(t)&&(t=t.getIdentifier()),i._name=e,i._source=this.getIdentifier(),i._target=t,this._sendObject(i)},"public respond":function(t,e,i){this.send(t._source,e,i)},"public broadcast":function(t,e,i){i&&(e._broadcastToSource=!0),this.send("broadcast",t,e)},"package _sendAck":function(t){var e={original:t};this.send(t._source,"_ack",e)},"package _sendObject":function(t){if("_name"in t==!1)return void console.warn("Tried to send message without _name, ignoring: "+JSON.stringify(t));t._id=CWUtil.randomInt(0,1e5),t._name=t._name.toLowerCase();var e=JSON.stringify(t);return CWDebug.log(4,"Sending message: "+e),this._websocket.send(e),t._id},"package _disconnectWebsocket":function(){this._websocket.close()},_cleanupWebsocket:function(){void 0!==this._websocket&&(this._websocket.onopen=void 0,this._websocket.onmessage=void 0,this._websocket.onclose=void 0,this._websocket.onerror=void 0,this._websocket=void 0)}}),CWNativeRemoteCommunication=OOP.createSingleton("Connichiwa","CWNativeRemoteCommunication",{_runsNative:!1,__constructor:function(){window.RUN_BY_CONNICHIWA_NATIVE===!0&&(this._runsNative=!0)},"public isRunningNative":function(){return this._runsNative===!0},"public callOnNative":function(t){if(this.isRunningNative()===!0){var e=Array.prototype.slice.call(arguments);e.shift();var i=window[t];"function"==typeof i?i.apply(null,e):CWDebug.log(1,"ERROR: Tried to call native method with name "+t+", but it doesn't exist!")}},"public parse":function(t){CWDebug.log(4,"Parsing native message (remote): "+t);var e=JSON.parse(t);switch(e._name){case"runsnative":this._parseRunsNative(e);break;case"connectwebsocket":this._parseConnectWebsocket(e);break;case"cwdebug":this._parseDebug(e);break;case"localinfo":this._parseLocalInfo(e);break;case"disconnectwebsocket":this._parseDisconnectWebsocket(e)}},_parseRunsNative:function(t){CWDebug.log(1,"RUNS NATIVE SET TO "+JSON.stringify(t)),this._runsNative=!0},_parseConnectWebsocket:function(){this.package.Connichiwa._connectWebsocket()},_parseDebug:function(){CWDebug.enableDebug()},_parseLocalInfo:function(t){this.package.Connichiwa._setLocalDevice(t),CWEventManager.trigger("ready")},_parseDisconnectWebsocket:function(){this.package.Connichiwa._disconnectWebsocket()}});OOP.extendSingleton("Connichiwa","CWWebsocketMessageParser",{"package parseOnRemote":function(t){switch(t._name){case"_softdisconnect":this._parseSoftDisconnect(t)}},_parseSoftDisconnect:function(){this.package.Connichiwa._softDisconnectWebsocket()}}),OOP.extendSingleton("Connichiwa","Connichiwa",{"private _localDevice":void 0,"private _softDisconnected":!1,"private _isReconnecting":!1,__constructor:function(){var t=this.package.CWNativeRemoteCommunication.isRunningNative();t!==!0&&this._connectWebsocket()},"public getLocalDevice":function(){return this._localDevice},"public getIdentifier":function(){return this._localDevice.getIdentifier()},"public isMaster":function(){return!1},"package _setLocalDevice":function(t){void 0===this._localDevice&&(t.isLocal=!0,this._localDevice=new CWDevice(t)),this.send("master","remoteinfo",t)},"package _connectWebsocket":function(){CWDebug.log(3,"Connecting");var t=this._websocket;this._cleanupWebsocket(),void 0!==t&&t.close();var e=new CWUtil.parseURL(document.URL);this._websocket=new WebSocket("ws://"+e.hostname+":"+(parseInt(e.port)+1)),this._websocket.onopen=this._onWebsocketOpen,this._websocket.onmessage=this._onWebsocketMessage,this._websocket.onclose=this._onWebsocketClose,this._websocket.onerror=this._onWebsocketError},_softDisconnectWebsocket:function(){this._softDisconnected=!0,CWNativeRemoteCommunication.callOnNative("nativeSoftDisconnect")},_onWebsocketOpen:function(){CWDebug.log(3,"Websocket opened"),this._softDisconnected=!1;var t=this.package.CWNativeRemoteCommunication.isRunningNative();if(CWNativeRemoteCommunication.callOnNative("nativeWebsocketDidOpen"),t===!1){if(this._isReconnecting===!0)return void location.reload(!0);var e={identifier:CWUtil.createUUID(),launchDate:Date.now()/1e3,ppi:CWSystemInfo.PPI()};this._setLocalDevice(e)}},_onWebsocketMessage:function(t){var e=JSON.parse(t.data);if("broadcast"!==e._target||e._source!==this.getLocalDevice().getIdentifier()||e._broadcastToSource===!0){CWDebug.log(4,"Received message: "+t.data);var i=this;window.requestAnimationFrame(function(){i.package.CWWebsocketMessageParser.parse(e),i.package.CWWebsocketMessageParser.parseOnRemote(e),e._name&&CWEventManager.trigger("message"+e._name,e)})}},_onWebsocketClose:function(){CWDebug.log(3,"Websocket closed"),this._cleanupWebsocket(),CWNativeRemoteCommunication.callOnNative("nativeWebsocketDidClose");this.package.CWNativeRemoteCommunication.isRunningNative()},_onWebsocketError:function(){CWDebug.log(3,"Error"),this._onWebsocketClose()},_tryWebsocketReconnect:function(){(void 0===this._websocket||this._websocket.readyState!==WebSocket.OPEN&&this._websocket.readyState!==WebSocket.CONNECTING)&&(this._isReconnecting=!0,CWDebug.log(3,"Try reconnect"),this._connectWebsocket())}});
//# sourceMappingURL=remote.min.js.map