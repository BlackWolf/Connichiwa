"use strict";function CWDevice(e){if(!e.identifier)throw"Cannot instantiate CWDevice without an identifier";this._identifier=e.identifier,this._discoveryState=CWDevice.DiscoveryState.LOST,this._connectionState=CWDevice.ConnectionState.DISCONNECTED,this._distance=-1,this._launchDate=Date.now()/1e3,this._ips=[],this._port=void 0,this._name="remote device",this._ppi=CWSystemInfo.DEFAULT_PPI,e.launchDate&&(this._launchDate=e.launchDate),e.ips&&(this._ips=e.ips),e.port&&(this._port=e.port),e.name&&(this._name=e.name),e.ppi&&e.ppi>0&&(this._ppi=e.ppi)}function CWLocation(e,t,i,n,a){if(void 0===a&&(a=!0),this._x=void 0,this._y=void 0,this._width=void 0,this._height=void 0,a===!0){var o=CWLocation._toGlobal(e,t,i,n);this._x=o.x,this._y=o.y,this._width=o.width,this._height=o.height}else this._x=e,this._y=t,this._width=i,this._height=n;CWEventManager.register("wasUnstitched",function(e){this._x-=e.deviceTransformation.x,this._y-=e.deviceTransformation.y,this._x*=e.deviceTransformation.scale,this._y*=e.deviceTransformation.scale,this._width*=e.deviceTransformation.scale,this._height*=e.deviceTransformation.scale}.bind(this)),CWEventManager.register("wasStitched",function(e){this._x/=e.deviceTransformation.scale,this._y/=e.deviceTransformation.scale,this._width/=e.deviceTransformation.scale,this._height/=e.deviceTransformation.scale,this._x+=e.deviceTransformation.x,this._y+=e.deviceTransformation.y}.bind(this))}function CWVector(e,t){if(void 0===e||void 0===t)throw"Cannot instantiate Vector without 2 points";this._p1=e,this._p2=t}var CWModules={};CWModules._modules=[],CWModules._didInit=!1,CWModules.add=function(e){-1===this._modules.indexOf(e)&&this._modules.push(e)}.bind(CWModules),CWModules.init=function(){if(this._didInit)throw"Cannot initialize modules twice";var e=this;window.setTimeout(function(){for(var t=0;t<e._modules.length;t++){var i=e._modules[t];console.log("Initializing module "+i+"..."),window[i].__constructor&&window[i].__constructor()}CWNativeBridge.callOnNative("nativeCallLibraryDidLoad")},0),this._didInit=!0}.bind(CWModules);var CWDatastore=CWDatastore||{};CWDatastore._data={},CWDatastore.__constructor=function(){Connichiwa.on("deviceconnected",function(e){CWDebug.log(3,"Syncing entire datastore to connected device"),CWDatastore._syncStoreToDevice(e.getIdentifier())})}.bind(CWDatastore),CWDatastore.set=function(e,t,i){void 0===i&&(i=t,t=e,e="_default"),this._set(e,t,i,!0,!1)}.bind(CWDatastore),CWDatastore.setMultiple=function(e,t){void 0===t&&(t=e,e="_default"),CWDatastore._set(e,t,void 0,!0,!0)}.bind(CWDatastore),CWDatastore._set=function(e,t,i,n,a){e in this._data==!1&&(this._data[e]={});var o;a?o=t:(o={},o[t]=i);var s=this,r={};$.each(o,function(i,n){if(CWUtil.isFunction(n))return CWDebug.err("Attempted to store function in CWDatastore (collection: "+e+", key: "+t+"). This is invalid and will be ignored."),!0;var a=s._data[e][i];s._data[e][i]=n,r[i]={old:a,new:n}}),n&&this._syncEntrys(e,Object.keys(r));var c="_default"===e?void 0:e;CWEventManager.trigger("_datastorechanged",c,r)}.bind(CWDatastore),CWDatastore.get=function(e,t){return void 0===t&&(t=e,e="_default"),e in this._data==!1||t in this._data[e]==!1?void 0:this._data[e][t]}.bind(CWDatastore),CWDatastore.getCollection=function(e){return this._getCollection(e,!0)}.bind(CWDatastore),CWDatastore._getCollection=function(e,t){return void 0===e&&(e="_default"),void 0===t&&(t=!0),e in this._data==!1&&(this._data[e]={}),t===!1?this._data[e]:$.extend(!0,{},this._data[e])}.bind(CWDatastore),CWDatastore._syncEntrys=function(e,t){var i={};i[e]={},CWUtil.isArray(t)===!1&&(t=[t]);var n=this;$.each(t,function(t,a){var o=n.get(e,a);void 0!==o&&(i[e][a]=o)}),Connichiwa.broadcast("_updatedatastore",{data:i})}.bind(CWDatastore),CWDatastore._syncStoreToDevice=function(e){Connichiwa.send(e,"_updatedatastore",{data:this._data})}.bind(CWDatastore);var CWDebug=CWDebug||{};CWDebug._debug=!1,CWDebug._logLevel=0,CWDebug.__constructor=function(){Ractive.DEBUG=!1}.bind(CWDebug),CWDebug._setDebugInfo=function(e){e.debug&&CWDebug.setDebug(e.debug),e.logLevel&&CWDebug.setLogLevel(e.logLevel)}.bind(CWDebug),CWDebug._getDebugInfo=function(){return{debug:this._debug,logLevel:this._logLevel}}.bind(CWDebug),CWDebug.log=function(e,t){this._debug&&e<=this._logLevel&&console.log(e+"|"+t)}.bind(CWDebug),CWDebug.err=function(e){this._debug&&console.err(e)}.bind(CWDebug),CWDebug.setDebug=function(e){this._debug=e}.bind(CWDebug),CWDebug.setLogLevel=function(e){this._logLevel=e}.bind(CWDebug),CWModules.add("CWDebug"),CWDevice.prototype.isLocal=function(){return this.equalTo(Connichiwa.getLocalDevice())},CWDevice.prototype.isNearby=function(){return this._discoveryState===CWDevice.DiscoveryState.DISCOVERED},CWDevice.prototype._canBeConnected=function(){return this._connectionState===CWDevice.ConnectionState.DISCONNECTED&&this._discoveryState===CWDevice.DiscoveryState.DISCOVERED},CWDevice.prototype.isConnected=function(){return this._connectionState===CWDevice.ConnectionState.CONNECTED},CWDevice.prototype.insert=function(e,t){if(void 0===t&&(t=e,e="body"),CWUtil.isObject(e)&&(e=$(e),e="#"+e.attr("id")),CWUtil.isObject(t)===!0){var i=$(t),n=i.clone();n[0].style.cssText=i[0].style.cssText,t=n[0].outerHTML}var a={selector:e,html:t};this.send("_insert",a)},CWDevice.prototype.replace=function(e,t){this._replace(e,t,!1)},CWDevice.prototype.replaceContent=function(e,t){this._replace(e,t,!0)},CWDevice.prototype._replace=function(e,t,i){if(void 0===t&&(t=e,e="body"),CWUtil.isObject(e)&&(e="#"+$(e).attr("id")),CWUtil.isObject(t)===!0){var n=$(t),a=n.clone();a[0].style.cssText=n[0].style.cssText,t=a[0].outerHTML}var o={selector:e,html:t,contentOnly:i};this.send("_replace",o)},CWDevice.prototype.loadScript=function(e,t){var i={url:e},n=this.send("_loadscript",i);void 0!==t&&Connichiwa.on("__ack_message"+n,t)},CWDevice.prototype.loadCSS=function(e){var t={url:e};this.send("_loadcss",t)},CWDevice.prototype.loadTemplates=function(e){var t={paths:e};this.send("_loadtemplate",t)},CWDevice.prototype.insertTemplate=function(e,t,i,n){var a={templateName:e,target:t,data:i},o=this.send("_inserttemplate",a);void 0!==n&&Connichiwa.on("__ack_message"+o,n)},CWDevice.prototype.send=function(e,t){return t._name=e,t._source=Connichiwa.getIdentifier(),t._target=this.getIdentifier(),Connichiwa._sendObject(t)},CWDevice.prototype.equalTo=function(e){return CWDevice.prototype.isPrototypeOf(e)===!1?!1:this.getIdentifier()===e.getIdentifier()},CWDevice.prototype.toString=function(){return this.getIdentifier()},CWDevice.prototype.getIdentifier=function(){return this._identifier},CWDevice.prototype.getDistance=function(){return this._distance},CWDevice.prototype.getLaunchDate=function(){return this._launchDate},CWDevice.prototype.getIPs=function(){return this._ips},CWDevice.prototype.getPort=function(){return this._port},CWDevice.prototype.getName=function(){return this._name},CWDevice.prototype.getPPI=function(){return this._ppi},CWDevice.DiscoveryState={DISCOVERED:"discovered",LOST:"lost"},CWDevice.ConnectionState={DISCONNECTED:"disconnected",CONNECTING:"connecting",CONNECTED:"connected"};var CWEventManager=CWEventManager||{};CWEventManager._callbacks={},CWEventManager.register=function(e,t){if(CWUtil.isString(e)===!1)throw"Event name must be a string";if(CWUtil.isFunction(t)===!1)throw"Event callback must be a function";if(e=e.toLowerCase(),-1===e.indexOf(" "))this._callbacks[e]||(this._callbacks[e]=[]),this._callbacks[e].push(t),CWDebug.log(3,"Attached callback to "+e);else for(var i=e.split(" "),n=0;n<i.length;n++)CWEventManager.register(i[n],t)}.bind(CWEventManager),CWEventManager.trigger=function(e,t){var i=Array.prototype.slice.call(arguments);if(CWUtil.isString(e)===!0?(t=e,e=4,i.shift()):(i.shift(),i.shift()),t=t.toLowerCase(),!this._callbacks[t])return void CWDebug.log(5,"No callbacks  for "+t+" registered");CWDebug.log(e,"Triggering event "+t+" for "+this._callbacks[t].length+" callbacks");for(var n=0;n<this._callbacks[t].length;n++){var a=this._callbacks[t][n];a.apply(null,i)}}.bind(CWEventManager),CWModules.add("CWEventManager");var CWGestures=CWGestures||{};CWGestures._touchStart=void 0,CWGestures._touchLast=void 0,CWGestures._touchLastVector=void 0,CWGestures._touchCheckable=!1,CWGestures._touchAngleReferenceVector=void 0,CWGestures._touchAngleChangedCount=0,CWGestures.__constructor=function(){var e=this;$(document).ready(function(){e._captureOn($("body"))})}.bind(CWGestures),CWGestures._onDown=function(e){this._touchStart=CWUtil.getEventLocation(e,"client")}.bind(CWGestures),CWGestures._onMove=function(e){if(void 0!==this._touchStart){var t=CWUtil.getEventLocation(e,"client");if(void 0!==this._touchLast){var i=new CWVector(this._touchStart,t),n=new CWVector(this._touchLast,t);if(this._touchCheckable=this._touchCheckable||i.length()>5,this._touchCheckable&&n.length()>1)if(void 0!==this._touchAngleReferenceVector){var a=n.angleBetween(this._touchAngleReferenceVector);if(a>20){if(this._touchAngleChangedCount++,3===this._touchAngleChangedCount)return this._touchStart=void 0,void(this._touchLast=void 0)}else this._touchAngleReferenceVector=void 0,this._touchAngleChangedCount=0}else if(void 0!==this._touchLastVector){var o=n.angleBetween(this._touchLastVector);o>20&&(this._touchAngleReferenceVector=this._touchLastVector,this._touchAngleChangedCount=1)}n.length()>0&&(this._touchLastVector=n)}this._touchLast=t}}.bind(CWGestures),CWGestures._onUp=function(){var e=this._touchStart,t=this._touchLast;if(this._touchStart=void 0,this._touchLast=void 0,this._touchLastVector=void 0,this._touchCheckable=!1,this._touchAngleReferenceVector=void 0,this._touchAngleChangedCount=0,void 0!==e&&void 0!==t){var i=t.x-e.x,n=t.y-e.y,a=Math.sqrt(Math.pow(i,2)+Math.pow(n,2));if(10>=a)return void CWDebug.log(3,"Swipe REJECTED because it was too short ("+a+")");var o=.25;100>a&&(o=.35),50>a&&(o=.4),40>a&&(o=.45),15>a&&(o=.8);var s="invalid";Math.abs(n)<Math.abs(i)*o&&(i>0&&(s="right"),0>i&&(s="left")),Math.abs(i)<Math.abs(n)*o&&(n>0&&(s="down"),0>n&&(s="up"));var r=$(window).height()-window.innerHeight;t.y+=r;var c=t.y<=50,h=t.x<=50,d=t.y>=$(window).height()-50,g=t.x>=$(window).width()-50,C="invalid";if(c&&"up"===s&&(C="top"),h&&"left"===s&&(C="left"),d&&"down"===s&&(C="bottom"),g&&"right"===s&&(C="right"),"invalid"===C)return void CWDebug.log(3,"Swipe REJECTED. Ending: x - "+t.x+"/"+($(window).width()-50)+", y - "+t.y+"/"+($(window).height()-50)+". Direction: "+s+". Edge endings: "+c+", "+g+", "+d+", "+h);"top"===C&&(t.y=0),"left"===C&&(t.x=0),"bottom"===C&&(t.y=$(window).height()),"right"===C&&(t.x=$(window).width());var l={edge:C,x:t.x,y:t.y};CWEventManager.trigger("stitchswipe",l)}}.bind(CWGestures),CWGestures._captureOn=function(e){e instanceof jQuery&&(e=e.get(0)),e.addEventListener("mousedown",this._onDown,!0),e.addEventListener("touchstart",this._onDown,!0),e.addEventListener("mousemove",this._onMove,!0),e.addEventListener("touchmove",this._onMove,!0),e.addEventListener("mouseup",this._onUp,!0),e.addEventListener("touchend",this._onUp,!0)}.bind(CWGestures),CWGestures.__constructor&&window.setTimeout(CWGestures.__constructor,0),CWModules.add("CWGestures");var CWGyroscope=CWGyroscope||{};CWGyroscope._lastMeasure=void 0,CWGyroscope._alphaGammaFlipped=!1,CWGyroscope.__constructor=function(){gyro.frequency=500,gyro.startTracking(this._onUpdate.bind(this))}.bind(CWGyroscope),CWGyroscope._onUpdate=function(e){if(null!==e.alpha&&null!==e.beta&&null!==e.gamma&&null!==e.x&&null!==e.y&&null!==e.z){if(void 0===this._lastMeasure&&(this._lastMeasure=e),e.alpha<0||e.gamma>180){this._alphaGammaFlipped=!0;var t=this._lastMeasure.alpha;this._lastMeasure.alpha=this._lastMeasure.gamma,this._lastMeasure.gamma=t}var i=this._alphaGammaFlipped?e.gamma:e.alpha,n=e.beta,a=this._alphaGammaFlipped?e.alpha:e.gamma,o=i-this._lastMeasure.alpha,s=n-this._lastMeasure.beta,r=a-this._lastMeasure.gamma,c={alpha:i,beta:n,gamma:a,delta:{alpha:o,beta:s,gamma:r}};CWEventManager.trigger(5,"gyroscopeUpdate",c);var h=e.x-this._lastMeasure.x,d=e.y-this._lastMeasure.y,g=e.z-this._lastMeasure.z,C={x:e.x,y:e.y,z:e.z,delta:{x:h,y:d,z:g}};CWEventManager.trigger(5,"accelerometerUpdate",C),this._lastMeasure={x:e.x,y:e.y,z:e.z,alpha:i,beta:n,gamma:a}}}.bind(CWGyroscope),CWGyroscope.getLastGyroscopeMeasure=function(){return void 0===this._lastMeasure?void 0:{alpha:this._lastMeasure.alpha,beta:this._lastMeasure.beta,gamma:this._lastMeasure.gamma}}.bind(CWGyroscope),CWGyroscope.getLastAccelerometerMeasure=function(){return void 0===this._lastMeasure?void 0:{x:this._lastMeasure.x,y:this._lastMeasure.y,z:this._lastMeasure.z}}.bind(CWGyroscope),CWModules.add("CWGyroscope"),CWLocation.prototype.getGlobal=function(){return{x:this._x,y:this._y,width:this._width,height:this._height}},CWLocation.prototype.getLocal=function(){return CWLocation._toLocal(this._x,this._y,this._width,this._height)},CWLocation.prototype.getGlobalX=function(){return this._x},CWLocation.prototype.getGlobalY=function(){return this._y},CWLocation.prototype.getGlobalWidth=function(){return this._width},CWLocation.prototype.getGlobalHeight=function(){return this._height},CWLocation.prototype.getLocalX=function(){return this.getLocal().x},CWLocation.prototype.getLocalY=function(){return this.getLocal().y},CWLocation.prototype.getLocalWidth=function(){return this.getLocal().width},CWLocation.prototype.getLocalHeight=function(){return this.getLocal().height},CWLocation.prototype.setGlobal=function(e,t,i,n){void 0!==e&&(this._x=e),void 0!==t&&(this._y=t),void 0!==i&&(this._width=i),void 0!==n&&(this._height=n)},CWLocation.prototype.setLocal=function(e,t,i,n){var a=CWLocation._toGlobal(e,t,i,n);this._x=a.x,this._y=a.y,this._width=a.width,this._height=a.height},CWLocation.prototype.setGlobalX=function(e){this.setGlobal(e,this._y,this._width,this._height)},CWLocation.prototype.setGlobalY=function(e){this.setGlobal(this._x,e,this._width,this._height)},CWLocation.prototype.setGlobalWidth=function(e){this.setGlobal(this._x,this._y,e,this._height)},CWLocation.prototype.setGlobalHeight=function(e){this.setGlobal(this._x,this._y,this._width,e)},CWLocation.prototype.setLocalX=function(e){var t=this.getLocal();this.setLocal(e,t.y,t.width,t.height)},CWLocation.prototype.setLocalY=function(e){var t=this.getLocal();this.setLocal(t.x,e,t.width,t.height)},CWLocation.prototype.setLocalWidth=function(e){var t=this.getLocal();this.setLocal(t.x,t.y,e,t.height)},CWLocation.prototype.setLocalHeight=function(e){var t=this.getLocal();this.setLocal(t.x,t.y,t.width,e)},CWLocation.prototype.toString=function(){return JSON.stringify(this.getGlobal())},CWLocation.prototype.copy=function(){return CWLocation.fromString(this.toString())},CWLocation._toGlobal=function(e,t,i,n){void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0);var a={x:e,y:t,width:i,height:n},o=CWStitchManager.getLocalDeviceTransformation();return 0===o.rotation&&(a.y=t,a.x=e,a.width=i,a.height=n),90===o.rotation&&(a.y=o.height*o.scale-e-i,a.x=t,a.width=n,a.height=i),180===o.rotation&&(a.y=o.height*o.scale-t-n,a.x=o.width*o.scale-e-i,a.width=i,a.height=n),270===o.rotation&&(a.y=e,a.x=o.width*o.scale-t-n,a.width=n,a.height=i),a.x+=o.x*o.scale,a.y+=o.y*o.scale,a.x/=o.scale,a.y/=o.scale,a.width/=o.scale,a.height/=o.scale,a},CWLocation._toLocal=function(e,t,i,n){void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0);var a={x:e,y:t,width:i,height:n},o=CWStitchManager.getLocalDeviceTransformation();return 0===o.rotation&&(a.y=t-o.y,a.x=e-o.x,a.width=i,a.height=n),90===o.rotation&&(a.y=e-o.x,a.x=o.height-(t-o.y+n),a.width=n,a.height=i),180===o.rotation&&(a.y=o.height-(t-o.y+n),a.x=o.width-(e-o.x+i),a.width=i,a.height=n),270===o.rotation&&(a.y=o.width-(e-o.x+i),a.x=t-o.y,a.width=n,a.height=i),a.x*=o.scale,a.y*=o.scale,a.width*=o.scale,a.height*=o.scale,a},CWLocation.applyRotation=function(e,t,i,n,a){var o=CWStitchManager.getLocalDeviceTransformation();void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===a&&(a=o.rotation);var s={x:e,y:t,width:i,height:n};return 0===o.rotation&&(s.y=t,s.x=e,s.width=i,s.height=n),90===o.rotation&&(s.y=-e,s.x=t,s.width=n,s.height=i),180===o.rotation&&(s.y=-t,s.x=-e,s.width=i,s.height=n),270===o.rotation&&(s.y=e,s.x=-t,s.width=n,s.height=i),s},CWLocation.fromString=function(e){var t=JSON.parse(e);return new CWLocation(parseFloat(t.x),parseFloat(t.y),parseFloat(t.width),parseFloat(t.height),!1)},CWLocation.fromPoint=function(e,t,i){return new CWLocation(e,t,void 0,void 0,i)},CWLocation.fromSize=function(e,t,i){return new CWLocation(void 0,void 0,e,t,i)};var CWNativeBridge=CWNativeBridge||{};CWNativeBridge._runsNative=!1,CWNativeBridge.__constructor=function(){window.RUN_BY_CONNICHIWA_NATIVE===!0&&(this._runsNative=!0)}.bind(CWNativeBridge),CWNativeBridge.isRunningNative=function(){return this._runsNative===!0}.bind(CWNativeBridge),CWNativeBridge.callOnNative=function(e){if(this.isRunningNative()===!0){var t=Array.prototype.slice.call(arguments);t.shift();var i=window[e];"function"==typeof i?i.apply(null,t):CWDebug.log(1,"ERROR: Tried to call native method with name "+e+", but it doesn't exist!")}}.bind(CWNativeBridge),CWNativeBridge.parse=function(){},CWModules.add("CWNativeBridge");var CWStitchManager=CWStitchManager||{};CWStitchManager._isStitched=!1,CWStitchManager._deviceTransformation=void 0,CWStitchManager._gyroDataOnStitch=void 0,CWStitchManager.unstitchOnMove=!0,CWStitchManager.ignoreMoveAxis=[],CWStitchManager.__constructor=function(){Connichiwa.on("stitchswipe",this._onLocalSwipe),Connichiwa.on("wasStitched",this._onWasStitched),Connichiwa.on("wasUnstitched",this._onWasUnstitched),Connichiwa.on("gyroscopeUpdate",this._onGyroUpdate),Connichiwa.on("accelerometerUpdate",this._onAccelerometerUpdate)}.bind(CWStitchManager),CWStitchManager._onWasStitched=function(e){this._gyroDataOnStitch=CWGyroscope.getLastGyroscopeMeasure(),this._deviceTransformation=e.deviceTransformation,this._isStitched=!0}.bind(CWStitchManager),CWStitchManager._onWasUnstitched=function(){this._gyroDataOnStitch=void 0,this._deviceTransformation=this.getDefaultDeviceTransformation(),this._isStitched=!1}.bind(CWStitchManager),CWStitchManager._onLocalSwipe=function(e){e.device=Connichiwa.getIdentifier(),e.width=CWSystemInfo.viewportWidth(),e.height=CWSystemInfo.viewportHeight(),Connichiwa.send("master","_stitchswipe",e)}.bind(CWStitchManager),CWStitchManager._onGyroUpdate=function(e){if(this.isStitched()!==!1&&this.unstitchOnMove!==!1){void 0===this._gyroDataOnStitch&&(this._gyroDataOnStitch=e);var t=Math.abs(e.alpha-this._gyroDataOnStitch.alpha),i=Math.abs(e.beta-this._gyroDataOnStitch.beta),n=Math.abs(e.gamma-this._gyroDataOnStitch.gamma);t=Math.abs((t+180)%360-180),i=Math.abs((i+180)%360-180),n=Math.abs((n+180)%360-180),(CWUtil.inArray("alpha",this.ignoreMoveAxis)===!1&&t>=35||CWUtil.inArray("beta",this.ignoreMoveAxis)===!1&&i>=20||CWUtil.inArray("gamma",this.ignoreMoveAxis)===!1&&n>=20)&&this._quitStitch()}}.bind(CWStitchManager),CWStitchManager._onAccelerometerUpdate=function(e){if(this.isStitched()!==!1&&this.unstitchOnMove!==!1){var t=Math.abs(e.x),i=Math.abs(e.y),n=Math.abs(Math.abs(e.z)-9.81);(CWUtil.inArray("x",this.ignoreMoveAxis)===!1&&t>=1||CWUtil.inArray("y",this.ignoreMoveAxis)===!1&&i>=1||CWUtil.inArray("z",this.ignoreMoveAxis)===!1&&n>=1)&&this._quitStitch()}}.bind(CWStitchManager),CWStitchManager._quitStitch=function(){var e={device:Connichiwa.getIdentifier()};Connichiwa.send("master","_quitstitch",e)}.bind(CWStitchManager),CWStitchManager.unstitch=function(){this._quitStitch()}.bind(CWStitchManager),CWStitchManager.isStitched=function(){return this._isStitched}.bind(CWStitchManager),CWStitchManager.getLocalDeviceTransformation=function(){return void 0===this._deviceTransformation?this.getDefaultDeviceTransformation():this._deviceTransformation}.bind(CWStitchManager),CWStitchManager.getDefaultDeviceTransformation=function(){return{x:0,y:0,width:CWSystemInfo.viewportWidth(),height:CWSystemInfo.viewportHeight(),rotation:0,scale:1}}.bind(CWStitchManager),CWModules.add("CWStitchManager");var CWSystemInfo=CWSystemInfo||{};CWSystemInfo.DEFAULT_PPI=100,CWSystemInfo.PPI=function(){var e=this.DEFAULT_PPI;return window.devicePixelRatio>1&&(e=142),"iPad"===navigator.platform&&(e=132),("iPhone"===navigator.platform||"iPod"===navigator.platform)&&(e=3===window.devicePixelRatio?153:163),e}.bind(CWSystemInfo),CWSystemInfo.isLandscape=function(){return window.innerHeight<window.innerWidth}.bind(CWSystemInfo),CWSystemInfo.viewportWidth=function(){return $(window).width()}.bind(CWSystemInfo),CWSystemInfo.viewportHeight=function(){return $(window).height()}.bind(CWSystemInfo),CWModules.add("CWSystemInfo");var CWTemplates=CWTemplates||{};CWTemplates._files=[],CWTemplates._templates={raw:{},compiled:[]},CWTemplates.__constructor=function(){var e=this;Connichiwa.on("_datastorechanged",function(t,i){t&&0===t.indexOf("_CWTemplates")&&$.each(i,function(t){$.each(e._templates.compiled,function(e,i){i.update(t)})})})}.bind(CWTemplates),CWTemplates.load=function(e){CWUtil.isString(e)&&(e=[e]);var t=this;$.each(e,function(e,i){if(i in t._files)return!0;var n=new $.Deferred;t._files.push(n),$.get(i).done(function(e){CWDebug.log(3,"Compiling template file "+i);var a=t._compile(e);a?n.resolve():n.reject()}).fail(function(){CWDebug.err("Template file "+i+" does not exist"),n.reject()})})}.bind(CWTemplates),CWTemplates.insert=function(e,t,i,n){var a=this;$.when.all(this._files).always(function(){CWDebug.log(3,"Inserting template "+e+" into DOM");var o;void 0===i?o=CWDatastore._getCollection("_CWTemplates.",!1):CWUtil.isString(i)?o=CWDatastore._getCollection("_CWTemplates."+i,!1):CWUtil.isObject(i)&&(o=i);var s=new Ractive({template:a._templates.raw[e],data:o,el:$(t),append:!0,partials:a._templates.raw});a._templates.compiled.push(s),void 0!==n&&n()})}.bind(CWTemplates),CWTemplates.set=function(e,t,i){void 0===i&&(i=t,t=e,e=""),CWDatastore.set("_CWTemplates."+e,t,i)}.bind(CWTemplates),CWTemplates.setMultiple=function(e,t){void 0===t&&(t=e,e=""),CWDatastore.setMultiple("_CWTemplates."+e,t)}.bind(CWTemplates),CWTemplates.get=function(e,t){return void 0===t&&(t=e,e=""),CWDatastore.get("_CWTemplates."+e,t)}.bind(CWTemplates),CWTemplates._compile=function(e){var t=$("<wrapper>");t.html(e);var i=this,n=t.find("template"),a=0;return n.each(function(e,t){t=$(t);var n=t.attr("name"),o=CWUtil.unescape(t.html());return void 0===n||0===n.length?(CWDebug.err(1,"Found template without name - template is ignored. Template Content: "+o),!0):(CWDebug.log(3,"Registering template: "+n),i._templates.raw[n]=o,void a++)}),1>a?!1:!0}.bind(CWTemplates),CWModules.add("CWTemplates");var CWUtil=CWUtil||{};CWUtil.parseURL=function(e){var t=document.createElement("a");return t.href=e,t}.bind(CWUtil),CWUtil.unescape=function(e){return e.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#039;/g,"'")}.bind(CWUtil),CWUtil.getEventLocation=function(e,t){void 0===t&&(t="page");var i={x:e[t+"X"],y:e[t+"Y"]};if(void 0===i.x||void 0===i.y){var n=void 0===e.originalEvent?e.targetTouches:e.originalEvent.targetTouches;i={x:n[0][t+"X"],y:n[0][t+"Y"]}}return i}.bind(CWUtil),CWUtil.randomInt=function(e,t){return void 0===t&&void 0!==e?(t=e,e=0):void 0===t&&void 0===e&&(e=0,t=Number.MAX_VALUE),Math.floor(Math.random()*(t-e+1))+e}.bind(CWUtil),CWUtil.isInt=function(e){return e===parseInt(e)}.bind(CWUtil),CWUtil.isString=function(e){return"string"==typeof e}.bind(CWUtil),CWUtil.isFunction=function(e){return"function"==typeof e}.bind(CWUtil),CWUtil.isObject=function(e){return"object"==typeof e&&null!==e}.bind(CWUtil),CWUtil.isArray=function(e){return Array.isArray(e)}.bind(CWUtil),CWUtil.inArray=function(e,t){return t.indexOf(e)>-1}.bind(CWUtil),CWUtil.createUUID=function(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,CWUtil.createUUID)}.bind(CWUtil),CWModules.add("CWUtil"),CWVector.prototype.deltaX=function(){return this._p2.x-this._p1.x},CWVector.prototype.deltaY=function(){return this._p2.y-this._p1.y},CWVector.prototype.length=function(){return Math.sqrt(Math.pow(this._deltaX,2)+Math.pow(this._deltaY,2))},CWVector.prototype.angleBetween=function(e){var t=this.deltaX()*e.deltaX()+this.deltaY()*e.deltaY(),i=this.length()*e.length();return Math.acos(t/i)*(180/Math.PI)},CWVector.prototype.getP1=function(){return this._p1},CWVector.prototype.getP2=function(){return this._p2};var CWWebsocketMessageParser=CWWebsocketMessageParser||{};CWWebsocketMessageParser.parse=function(e){switch(e._name){case"_chunk":this._parseChunk(e);break;case"_ack":this._parseAck(e);break;case"_insert":this._parseInsert(e);break;case"_replace":this._parseReplace(e);break;case"_loadscript":this._parseLoadScript(e);break;case"_loadcss":this._parseLoadCSS(e);break;case"_loadtemplate":this._parseLoadTemplate(e);break;case"_inserttemplate":this._parseInsertTemplate(e);break;case"_wasstitched":this._parseWasStitched(e);break;case"_wasunstitched":this._parseWasUnstitched(e);break;case"_gotstitchneighbor":this._parseGotStitchNeighbor(e);break;case"_updatedatastore":this._parseUpdateDatastore(e)}return!0}.bind(CWWebsocketMessageParser),CWWebsocketMessageParser._parseAck=function(e){CWEventManager.trigger("__ack_message"+e.original._id)}.bind(CWWebsocketMessageParser),CWWebsocketMessageParser._parseInsert=function(e){$(e.selector).append(e.html)}.bind(CWWebsocketMessageParser),CWWebsocketMessageParser._parseReplace=function(e){e.contentOnly===!0?$(e.selector).html(e.html):$(e.selector).replaceWith(e.html)}.bind(CWWebsocketMessageParser),CWWebsocketMessageParser._parseLoadScript=function(e){$.getScript(e.url).done(function(){Connichiwa._sendAck(e)}).fail(function(t,i,n){CWDebug.err(1,"There was an error loading '"+e.url+"': "+n)})}.bind(CWWebsocketMessageParser),CWWebsocketMessageParser._parseLoadCSS=function(e){var t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("type","text/css"),t.setAttribute("href",e.url),$("head").append(t),Connichiwa._sendAck(e)}.bind(CWWebsocketMessageParser),CWWebsocketMessageParser._parseLoadTemplate=function(e){CWTemplates.load(e.paths)},CWWebsocketMessageParser._parseInsertTemplate=function(e){CWTemplates.insert(e.templateName,e.target,e.data,function(){Connichiwa._sendAck(e)})},CWWebsocketMessageParser._parseWasStitched=function(e){CWEventManager.trigger("wasStitched",e)}.bind(CWWebsocketMessageParser),CWWebsocketMessageParser._parseWasUnstitched=function(e){CWEventManager.trigger("wasUnstitched",e)}.bind(CWWebsocketMessageParser),CWWebsocketMessageParser._parseGotStitchNeighbor=function(e){CWEventManager.trigger("gotstitchneighbor",e)}.bind(CWWebsocketMessageParser),CWWebsocketMessageParser._parseUpdateDatastore=function(e){$.each(e.data,function(e,t){CWDatastore._set(e,t,void 0,!1,!0)})}.bind(CWWebsocketMessageParser),CWModules.add("CWWebsocketMessageParser");var Connichiwa=Connichiwa||{};Connichiwa._websocket=void 0,Connichiwa.getLocalDevice=function(){},Connichiwa.getIdentifier=function(){},Connichiwa.isMaster=function(){},Connichiwa._connectWebsocket=function(){},Connichiwa._onWebsocketOpen=function(){},Connichiwa._onWebsocketMessage=function(){},Connichiwa._onWebsocketClose=function(){},Connichiwa._onWebsocketError=function(){},Connichiwa.__constructor=function(){if(CWNativeBridge.isRunningNative()!==!0&&Connichiwa.isMaster()){var e=new CWUtil.parseURL(document.URL);return void(window.location="http://"+e.hostname+":"+e.port+"/remote")}CWNativeBridge.isRunningNative()!==!0&&this._connectWebsocket()}.bind(Connichiwa),Connichiwa.on=function(e,t){return"load"===e?void this.onLoad(t):void CWEventManager.register(e,t)}.bind(Connichiwa),Connichiwa.onMessage=function(e,t){this.on("message"+e,t)}.bind(Connichiwa),Connichiwa.onLoad=function(e){"complete"===document.readyState?(CWDebug.log(1,"Fire immediately"),window.setTimeout(e,0)):(CWDebug.log(1,"Fire delayed"),this.on("ready",e))}.bind(Connichiwa),Connichiwa.send=function(e,t,i){return i._name=t,i._source=Connichiwa.getIdentifier(),i._target=e,this._sendObject(i)}.bind(Connichiwa),Connichiwa.respond=function(e,t,i){this.send(e._source,t,i)}.bind(Connichiwa),Connichiwa.broadcast=function(e,t,i){i&&(t._broadcastToSource=!0),this.send("broadcast",e,t)}.bind(Connichiwa),Connichiwa._sendAck=function(e){var t={original:e};this.send(e._source,"_ack",t)}.bind(Connichiwa),Connichiwa._sendObject=function(e){if("_name"in e==!1)return void CWDebug.err("Tried to send message without _name, ignoring: "+JSON.stringify(e));e._id=CWUtil.randomInt(0,9999999999),e._name=e._name.toLowerCase();var t=JSON.stringify(e);return CWDebug.log(4,"Sending message: "+t),this._websocket.send(t),e._id}.bind(Connichiwa),Connichiwa._disconnectWebsocket=function(){this._websocket.close()}.bind(Connichiwa),Connichiwa._cleanupWebsocket=function(){void 0!==this._websocket&&(this._websocket.onopen=void 0,this._websocket.onmessage=void 0,this._websocket.onclose=void 0,this._websocket.onerror=void 0,this._websocket=void 0)}.bind(Connichiwa),CWModules.add("Connichiwa"),function(e){e(function(){e.when.all=function(t){var i=new e.Deferred,n=t.length,a=!1;return e.each(t,function(e,t){t.fail(function(){a=!0}).always(function(){n--,0===n&&(a?i.reject():i.resolve())})}),i}})}(jQuery),CWDevice.prototype.connect=function(){this._canBeConnected()!==!1&&(this._connectionState=CWDevice.ConnectionState.CONNECTING,CWNativeBridge.callOnNative("nativeCallConnectRemote",this.getIdentifier()))};var CWDeviceManager=CWDeviceManager||{};CWDeviceManager._localDevice=void 0,CWDeviceManager._remoteDevices=[],CWDeviceManager.addDevice=function(e){if(CWDevice.prototype.isPrototypeOf(e)===!1)throw"Cannot add a non-device";return null!==this.getDeviceWithIdentifier(e.getIdentifier())?!1:(CWDebug.log(3,"Added device: "+e.getIdentifier()),this._remoteDevices.push(e),!0)}.bind(CWDeviceManager),CWDeviceManager.removeDevice=function(e){CWDevice.prototype.isPrototypeOf(e)===!0&&(e=e.getIdentifier());var t=this.getDeviceWithIdentifier(e);if(null===t)return!1;CWDebug.log("Removed device: "+e);var i=this._remoteDevices.indexOf(t);return this._remoteDevices.splice(i,1),!0}.bind(CWDeviceManager),CWDeviceManager.getDeviceWithIdentifier=function(e){if(void 0!==this._localDevice&&(e===this._localDevice.getIdentifier()||"master"===e))return this._localDevice;for(var t=0;t<this._remoteDevices.length;t++){var i=this._remoteDevices[t];if(i.getIdentifier()===e)return i}return null}.bind(CWDeviceManager),CWDeviceManager.getConnectedDevices=function(){for(var e=[],t=0;t<this._remoteDevices.length;t++){var i=this._remoteDevices[t];i.isConnected()&&e.push(i)}return e}.bind(CWDeviceManager),CWDeviceManager.createLocalDevice=function(e){return void 0!==this._localDevice?!1:(e.isLocal=!0,this._localDevice=new CWDevice(e),this._localDevice._discoveryState=CWDevice.DiscoveryState.LOST,this._localDevice._connectionState=CWDevice.ConnectionState.CONNECTED,CWDebug.log(3,"Created local device: "+JSON.stringify(e)),!0)}.bind(CWDeviceManager),CWDeviceManager.getLocalDevice=function(){return this._localDevice}.bind(CWDeviceManager),CWModules.add("CWDeviceManager");var CWNativeBridge=CWNativeBridge||{};CWNativeBridge.parse=function(e){CWDebug.log(4,"Parsing native message (master): "+e);var t=JSON.parse(e);switch(t._name){case"debuginfo":this._parseDebugInfo(t);break;case"connectwebsocket":this._parseConnectWebsocket(t);break;case"localinfo":this._parseLocalInfo(t);break;case"devicedetected":this._parseDeviceDetected(t);break;case"devicedistancechanged":this._parseDeviceDistanceChanged(t);break;case"devicelost":this._parseDeviceLost(t);break;case"remoteconnectfailed":this._parseRemoteConnectFailed(t);break;case"remotedisconnected":this._parseRemoteDisconnected(t);break;case"disconnectwebsocket":this._parseDisconnectWebsocket(t)}}.bind(CWNativeBridge),CWNativeBridge._parseDebugInfo=function(e){CWDebug._setDebugInfo(e)}.bind(CWNativeBridge),CWNativeBridge._parseConnectWebsocket=function(){Connichiwa._connectWebsocket()
}.bind(CWNativeBridge),CWNativeBridge._parseLocalInfo=function(e){var t=CWDeviceManager.createLocalDevice(e);t&&(Connichiwa._sendObject(e),CWEventManager.trigger("ready"))}.bind(CWNativeBridge),CWNativeBridge._parseDeviceDetected=function(e){var t=CWDeviceManager.getDeviceWithIdentifier(e.identifier);if(null===t&&(t=new CWDevice(e),CWDeviceManager.addDevice(t)),t._discoveryState=CWDevice.DiscoveryState.DISCOVERED,CWDebug.log(2,"Detected device: "+t.getIdentifier()),CWEventManager.trigger("deviceDetected",t),Connichiwa.autoConnect===!0){var i=CWDeviceManager.getLocalDevice();i.getLaunchDate()<t.getLaunchDate()&&t.connect()}}.bind(CWNativeBridge),CWNativeBridge._parseDeviceDistanceChanged=function(e){var t=CWDeviceManager.getDeviceWithIdentifier(e.identifier);null!==t&&(t._distance=parseFloat(e.distance),CWDebug.log(5,"Updated distance of device "+t.getIdentifier()+" to "+t.getDistance()),CWEventManager.trigger("deviceDistanceChanged",t))}.bind(CWNativeBridge),CWNativeBridge._parseDeviceLost=function(e){var t=CWDeviceManager.getDeviceWithIdentifier(e.identifier);t._discoveryState=CWDevice.DiscoveryState.LOST,CWDebug.log(2,"Lost device: "+t.getIdentifier()),CWEventManager.trigger("deviceLost",t)}.bind(CWNativeBridge),CWNativeBridge._parseRemoteConnectFailed=function(e){var t=CWDeviceManager.getDeviceWithIdentifier(e.identifier);t._connectionState=CWDevice.ConnectionState.DISCONNECTED,CWDebug.log(2,"Connection to remote device failed: "+t.getIdentifier()),CWEventManager.trigger("connectFailed",t)}.bind(CWNativeBridge),CWNativeBridge._parseRemoteDisconnected=function(e){var t=CWDeviceManager.getDeviceWithIdentifier(e.identifier);null!==t&&(t._connectionState=CWDevice.ConnectionState.DISCONNECTED,CWDebug.log(2,"Device disconnected: "+t.getIdentifier()),CWEventManager.trigger("deviceDisconnected",t))}.bind(CWNativeBridge),CWNativeBridge._parseDisconnectWebsocket=function(){Connichiwa._disconnectWebsocket()}.bind(CWNativeBridge),CWModules.add("CWNativeBridge");var CWStitchManager=CWStitchManager||{};CWStitchManager._swipes={},CWStitchManager._devices={},CWStitchManager.getDeviceTransformation=function(e){return this._getDeviceTransformation(e,!1)}.bind(CWStitchManager),CWStitchManager._getDeviceTransformation=function(e,t){if(void 0===e&&(e=Connichiwa.getIdentifier()),CWDevice.prototype.isPrototypeOf(e)&&(e=e.getIdentifier()),void 0===t&&(t=!1),e===Connichiwa.getIdentifier()&&t!==!0)return this.getLocalDeviceTransformation();var i=this._getStitchData(e);return void 0===i?this.getDefaultDeviceTransformation():{width:i.width,height:i.height,x:i.transformX,y:i.transformY,rotation:i.rotation,scale:i.scale}}.bind(CWStitchManager),CWStitchManager.detectedSwipe=function(e){var t={date:new Date,device:e.device,edge:e.edge,width:e.width,height:e.height,x:e.x,y:e.y},i=CWDeviceManager.getDeviceWithIdentifier(t.device);if(null!==i&&i.isConnected()!==!1){CWDebug.log(3,"Detected swipe on "+t.device+" on edge "+t.edge);for(var n in this._swipes){var a=this._swipes[n];if(CWDebug.log(4,"Checking existing swipe: "+n),a.device!==t.device&&(CWDebug.log(4,"Checking time constraint"),!(t.date.getTime()-a.date.getTime()>1e3))){CWDebug.log(4,"Checking connection constraint");var o=CWDeviceManager.getDeviceWithIdentifier(a.device);if(null!==o&&o.isConnected()!==!1)return void this._detectedStitch(a,t)}}this._swipes[t.device]=t}}.bind(CWStitchManager),CWStitchManager.unstitchDevice=function(e){if(e in this._devices){var t={deviceTransformation:this.getDeviceTransformation(e)};Connichiwa.send(e,"_wasunstitched",t),delete this._devices[e],CWDebug.log(3,"Device was unstitched: "+e)}}.bind(CWStitchManager),CWStitchManager._detectedStitch=function(e,t){function i(e,t){var i={};return 0===t&&(i.y=e.y,i.x=e.x,i.width=e.width,i.height=e.height),90===t&&(i.y=e.width-e.x,i.x=e.y,i.width=e.height,i.height=e.width),180===t&&(i.y=e.height-e.y,i.x=e.width-e.x,i.width=e.width,i.height=e.height),270===t&&(i.y=e.x,i.x=e.height-e.y,i.width=e.height,i.height=e.width),i}if(0===Object.keys(this._devices).length){if(t.device===Connichiwa.getIdentifier()){var n=e;e=t,t=n}var a=this._createStitchData(e.device);a.width=e.width,a.height=e.height,this._devices[e.device]=a,CWDebug.log(3,"First device was auto-stitched: "+JSON.stringify(a)),CWEventManager.trigger("stitch",t.device,e.device);var o={otherDevice:t.device,edge:e.edge,deviceTransformation:this._getDeviceTransformation(e.device,!0)};Connichiwa.send(e.device,"_wasstitched",o)}var s=this._getStitchData(e.device),r=this._getStitchData(t.device);if(!(void 0===s&&void 0===r||void 0!==s&&void 0!==r)){var c,h;void 0!==s?(c=e,h=t):(c=t,h=e);var d=CWDeviceManager.getDeviceWithIdentifier(c.device),g=CWDeviceManager.getDeviceWithIdentifier(h.device),C=this._getStitchData(c.device),l=this._createStitchData(h.device);l.scale=g.getPPI()/d.getPPI()*C.scale;var u=0,v=this._indexForEdge(c.edge)-this._indexForEdge(h.edge);0>v&&(v+=4),2===v&&(u=0),3===v&&(u=90),1===v&&(u=270),0===v&&(u=180),l.rotation=(u+C.rotation)%360;var W=i(h,l.rotation);W.edge=(this._indexForEdge(h.edge)+l.rotation/90)%4,W.y/=l.scale,W.x/=l.scale,W.width/=l.scale,W.height/=l.scale;var _=i(c,C.rotation);_.edge=(this._indexForEdge(c.edge)+C.rotation/90)%4,_.y/=C.scale,_.x/=C.scale,_.width/=C.scale,_.height/=C.scale,l.width=W.width,l.height=W.height,l.deviceWidth=h.width,l.deviceHeight=h.height,l.transformX=C.transformX+_.x-W.x,l.transformY=C.transformY+_.y-W.y,this._devices[h.device]=l,CWDebug.log(3,"Device was stitched: "+JSON.stringify(l)),CWEventManager.trigger("stitch",c.device,h.device);var o={otherDevice:c.device,edge:h.edge,deviceTransformation:this._getDeviceTransformation(h.device,!0)};g.send("_wasstitched",o);var f={otherDevice:h.device,edge:c.edge};d.send("_gotstitchneighbor",f)}}.bind(CWStitchManager),CWStitchManager._createStitchData=function(e){return{device:e,width:0,height:0,transformX:0,transformY:0,rotation:0,scale:1}}.bind(CWStitchManager),CWStitchManager._getStitchData=function(e){return CWDevice.prototype.isPrototypeOf(e)&&(e=e.getIdentifier()),this._devices[e]}.bind(CWStitchManager),CWStitchManager._indexForEdge=function(e){switch(e){case"top":return 0;case"bottom":return 2;case"left":return 1;case"right":return 3}return-1}.bind(CWStitchManager),CWStitchManager._edgeForIndex=function(e){switch(e){case 0:return"top";case 2:return"bottom";case 3:return"right";case 1:return"left"}return"invalid"}.bind(CWStitchManager),CWModules.add("CWStitchManager");var CWWebsocketMessageParser=CWWebsocketMessageParser||{};CWWebsocketMessageParser.parseOnMaster=function(e){switch(e._name){case"remoteinfo":this._parseRemoteInfo(e);break;case"_stitchswipe":this._parseStitchSwipe(e);break;case"_quitstitch":this._parseQuitStitch(e)}return!0}.bind(CWWebsocketMessageParser),CWWebsocketMessageParser._parseRemoteInfo=function(e){var t=CWDeviceManager.getDeviceWithIdentifier(e.identifier);null===t?(t=new CWDevice(e),CWDeviceManager.addDevice(t)):CWDebug.log(1,"TODO"),t._connectionState=CWDevice.ConnectionState.CONNECTED,nativeCallRemoteDidConnect(t.getIdentifier()),t.send("_debuginfo",CWDebug._getDebugInfo());for(var i=function(){CWEventManager.trigger("deviceConnected",t)},n=function(e,t){var i=t.split(".").pop().toLowerCase();"css"===i&&e.loadCSS(t)},a=[],o=[],s=0;s<Connichiwa.autoLoad.length;s++){var r=Connichiwa.autoLoad[s],c=r.split(".").pop().toLowerCase();"js"===c?a.push(r):o.push(r)}for(var s=0;s<o.length;s++){var r=o[s];n(t,r)}if(a.length>0)for(var s=0;s<a.length;s++){var h=a[s];s===a.length-1?t.loadScript(h,i):t.loadScript(h)}else i()}.bind(CWWebsocketMessageParser),CWWebsocketMessageParser._parseStitchSwipe=function(e){CWStitchManager.detectedSwipe(e)}.bind(CWWebsocketMessageParser),CWWebsocketMessageParser._parseQuitStitch=function(e){CWStitchManager.unstitchDevice(e.device)}.bind(CWWebsocketMessageParser),CWModules.add("CWWebsocketMessageParser");var Connichiwa=Connichiwa||{};Connichiwa._connectionAttempts=0,Connichiwa.autoConnect=!1,Connichiwa.autoLoad=[],Connichiwa.getLocalDevice=function(){return CWDeviceManager.getLocalDevice()}.bind(Connichiwa),Connichiwa.getIdentifier=function(){var e=CWDeviceManager.getLocalDevice();return void 0===e?void 0:e.getIdentifier()}.bind(Connichiwa),Connichiwa.isMaster=function(){return!0}.bind(Connichiwa),Connichiwa.getIPs=function(){var e=CWDeviceManager.getLocalDevice();return void 0===e?void 0:e.getIPs()}.bind(Connichiwa),Connichiwa.getPort=function(){var e=CWDeviceManager.getLocalDevice();return void 0===e?void 0:e.getPort()}.bind(Connichiwa),Connichiwa._connectWebsocket=function(){(void 0===this._websocket||this._websocket.state!==CONNECTING&&this._websocket.state!==OPEN)&&(this._cleanupWebsocket(),CWDebug.log(3,"Connecting websocket"),this._websocket=new WebSocket("ws://127.0.0.1:8001"),this._websocket.onopen=this._onWebsocketOpen,this._websocket.onmessage=this._onWebsocketMessage,this._websocket.onclose=this._onWebsocketClose,this._websocket.onerror=this._onWebsocketError,this._connectionAttempts++)}.bind(Connichiwa),Connichiwa._onWebsocketOpen=function(){CWDebug.log(3,"Websocket opened"),CWNativeBridge.callOnNative("nativeCallWebsocketDidOpen"),this._connectionAttempts=0}.bind(Connichiwa),Connichiwa._onWebsocketMessage=function(e){var t=JSON.parse(e.data);if("broadcast"!==t._target||t._source!==this.getLocalDevice().getIdentifier()||t._broadcastToSource===!0){CWDebug.log(4,"Received message: "+e.data);window.requestAnimationFrame(function(){CWWebsocketMessageParser.parse(t),CWWebsocketMessageParser.parseOnMaster(t),t._name&&CWEventManager.trigger("message"+t._name,t)})}}.bind(Connichiwa),Connichiwa._onWebsocketClose=function(e){return CWDebug.log(3,"Websocket closed"),CWDebug.log(3,e.code),CWDebug.log(3,e.reason),this._cleanupWebsocket(),this._connectionAttempts>=5?void CWNativeBridge.callOnNative("nativeCallWebsocketDidClose"):void 0}.bind(Connichiwa),Connichiwa._onWebsocketError=function(){this._onWebsocketClose()}.bind(Connichiwa),CWModules.add("Connichiwa"),CWModules.init();
//# sourceMappingURL=connichiwa.min.js.map